{"version":3,"file":"UseDragSort.dev.js","sources":["../src/core/utils.js","../src/core/mouse-handler.js","../src/core/mouse-dragsort.js","../src/core/mouse-scroll-y.js","../src/index.js"],"sourcesContent":["export const types = {};\r\n\r\nexport const openLog = (type) => {\r\n  types[type] = true;\r\n};\r\n\r\nexport const cloneLog = (type) => {\r\n  types[type] = false;\r\n};\r\n\r\nexport const printLog = (message, type) => {\r\n  if (types[type] || type === undefined) {\r\n    console.log(message);\r\n  }\r\n};\r\n/*\r\n * 为mixpad的鼠标事件添加获取path的方法\r\n * */\r\nexport const getPath = (mouseEvent) => {\r\n  if (mouseEvent.path) {\r\n    return mouseEvent.path;\r\n  } else {\r\n    const target = mouseEvent.target;\r\n    let path = [target];\r\n    if (target instanceof Node) {\r\n      let parent = target.parentElement;\r\n      while (parent) {\r\n        path.push(parent);\r\n        parent = parent.parentElement;\r\n      }\r\n      return path;\r\n    } else {\r\n      return path;\r\n    }\r\n  }\r\n};\r\n","import { printLog, openLog } from './utils';\r\n\r\nopenLog('mouse-handler');\r\n\r\n// 事件\r\nconst EVENT_TYPE = {\r\n  click: 'click', // 点击事件\r\n  press: 'press', // 长按事件\r\n  pressEnd: 'pressEnd', // 长按结束\r\n  move: 'move' // 移动\r\n};\r\n\r\nconst ASSERT_MOVE = 20; // 断言长按与移动,px\r\nconst ASSERT_PRESS = 300; // 断言点击长按,ms\r\n\r\nconst isPc = IsPC();\r\n\r\nconst eventTyps = {\r\n  start: 'touchstart',\r\n  move: 'touchmove',\r\n  end: 'touchend'\r\n};\r\n\r\nif(isPc) {\r\n  eventTyps.start = 'mousedown';\r\n  eventTyps.move = 'mousemove';\r\n  eventTyps.end = 'mouseup';\r\n}\r\n\r\n// 监听一个元素内的鼠标事件\r\nexport default class MouseHandler {\r\n  constructor(options) {\r\n    if (options.el instanceof Node) this.el = options.wrap || options.el;\r\n    else throw Error('el must be a Element');\r\n    this.$options = options; // 内含一系列钩子\r\n    this.initData();\r\n    /*\r\n     * 每次鼠标动作都有3个状态\r\n     * 按下、移动、抬起（down，move，up）\r\n     * 通过分析动作，确定鼠标操作的场景，并抛出一系列的钩子\r\n     * --------------------\r\n     * 场景包括:\r\n     * 点击 * 长按 * 移动 * 上滑 * 下滑 * 左->右 * 右->左 * 顶部边缘下滑 * 底部边缘上滑 * 左边缘右滑 * 右边缘左滑\r\n     * --------------------\r\n     * 钩子包括:\r\n     * click * press * pressEnd * toTop * toBottom * leftToRight * rightToleft * topEdge * bottomEdge * leftEdge * rightEdge\r\n     * --------------------\r\n     * 现在先分析 长按->拖拽 场景\r\n     * */\r\n    this.el.addEventListener(eventTyps.start, this.mousedown.bind(this));\r\n    this.el.addEventListener(eventTyps.move, this.mousemove.bind(this));\r\n    // this.el.addEventListener('mouseup', this.mouseup.bind(this));\r\n    document.addEventListener(eventTyps.end, this.mouseup.bind(this));\r\n  }\r\n\r\n  // 初始化值\r\n  initData() {\r\n    this.scene = null; // 当前动作场景\r\n    this.action = null; // 动作状态\r\n    this.downtime = 0; // 按下时的时间\r\n    this.uptime = 0; //抬起的时间\r\n    this.startCoor = { x: 0, y: 0 }; // 按下时鼠标位置\r\n    this.moveCoor = { x: 0, y: 0 }; // 移动时鼠标位置\r\n    this.endCoor = { x: 0, y: 0 }; // 放开时时鼠标位置\r\n    this.stop = false;\r\n  }\r\n\r\n  // 鼠标按下\r\n  mousedown(e) {\r\n    if (this.stop) e.stopPropagation();\r\n    this.setAction('down'); // 鼠标按下\r\n    this.downtime = new Date().getTime();\r\n    this.startCoor = { x: e.x, y: e.y };\r\n    if (typeof this.down === 'function') this.down(e);\r\n    setTimeout(() => {\r\n      // 当超过断言值时\r\n      printLog('action------------------------' + this.action, 'mouse-handler');\r\n      if (this.action && this.action !== 'up' && this.assertPressOrMove().isPress) {\r\n        this.setScene('press');\r\n        if (typeof this.press === 'function') this.press(e);\r\n      }\r\n    }, this.$options.pressDelay || ASSERT_PRESS);\r\n  }\r\n\r\n  // 鼠标移动\r\n  mousemove(e) {\r\n    if (this.stop) e.stopPropagation();\r\n    this.moveCoor = { x: e.x, y: e.y };\r\n    // this.setAction('move'); // 鼠标按下\r\n    if (typeof this.move === 'function') this.move(e, this.startCoor, this.moveCoor);\r\n  }\r\n\r\n  // 鼠标抬起\r\n  mouseup(e) {\r\n    if (this.stop) e.stopPropagation();\r\n    this.setAction('up'); // 鼠标按下\r\n    this.uptime = new Date().getTime();\r\n    const during = this.uptime - this.downtime;\r\n    this.endCoor = { x: e.x, y: e.y };\r\n    // 断言是点击还是长按：scene未被设置，且点击间隔少于 ASSERT_PRESS\r\n    if (during <= (this.$options.pressDelay || ASSERT_PRESS)) {\r\n      this.setScene('click');\r\n      if (typeof this.click === 'function') this.click(e);\r\n    } else if (this.assertPressOrMove().isPress) {\r\n      this.setScene('pressEnd');\r\n      if (typeof this.pressEnd === 'function') this.pressEnd(e);\r\n    }\r\n    this.eventOver();\r\n  }\r\n\r\n  // 断言当前是长按还是移动，\r\n  assertPressOrMove() {\r\n    const _x = Math.abs(this.startCoor.x - this.moveCoor.x);\r\n    const _y = Math.abs(this.startCoor.y - this.moveCoor.y);\r\n    let isPress = false;\r\n    if (_x <= ASSERT_MOVE && _y <= ASSERT_MOVE) {\r\n      isPress = true;\r\n    }\r\n    return { isPress, isMove: !isPress };\r\n  }\r\n\r\n  // 设置当前场景\r\n  setScene(scene) {\r\n    printLog('---------------------' + scene, 'mouse-handler');\r\n    this.scene = scene;\r\n  }\r\n\r\n  // 设置当前动作\r\n  setAction(action) {\r\n    printLog('---------------------' + action, 'mouse-handler');\r\n    this.action = action;\r\n  }\r\n\r\n  // 一个事件的结束\r\n  eventOver(e) {\r\n    if (typeof this.over === 'function') this.over(e);\r\n    this.initData();\r\n  }\r\n}\r\n\r\nfunction IsPC() {\r\n  var userAgentInfo = navigator.userAgent;\r\n  var Agents = [\"Android\", \"iPhone\",\r\n              \"SymbianOS\", \"Windows Phone\",\r\n              \"iPad\", \"iPod\"];\r\n  var flag = true;\r\n  for (var v = 0; v < Agents.length; v++) {\r\n      if (userAgentInfo.indexOf(Agents[v]) > 0) {\r\n          flag = false;\r\n          break;\r\n      }\r\n  }\r\n  return flag;\r\n}\r\n","import { printLog, openLog, getPath } from './utils';\r\nimport MouseHandler from './mouse-handler';\r\n\r\nopenLog('move-block');\r\n\r\nexport default class UseDragSort {\r\n  /*\r\n   * id元素布局必需是非static，内部项的style尽量为null\r\n   * 所有移动块上需设置name=\"move-block\" :move-index=\"key\"\r\n   * 当进行布局时，将会是一个非常耗费性能的操作\r\n   * */\r\n  constructor(options) {\r\n    /*\r\n     * 这里仅获取当前调用组件内的元素\r\n     * 若是其他地方有重复组件（如首屏滑块），需要将排序数据存入store\r\n     * */\r\n    if (options.el instanceof Node) this.el = options.el;\r\n    else throw Error('el must be a Element');\r\n    this.currentDom = null; // 当前变动位置的元素\r\n    this.currentKey = null; // 当前变动位置的元素索引\r\n    // 移动中排序定时器\r\n    this.moveTimer = null;\r\n    /*\r\n     * 实例化鼠标事件\r\n     * */\r\n    this.initMouse(options);\r\n    // 获取与重置数据源\r\n    this.getList = options.getList;\r\n    this.resetList = options.resetList;\r\n    // 移动中的样式\r\n    this.activeClass = options.activeClass || '';\r\n    this.currentBaseClass = '';\r\n    this.scroll = options.scroll;\r\n    this.fixScrollY = 0;\r\n    this.cacheMove = null;\r\n  }\r\n\r\n  // 查找滚动元素\r\n  getScrollEle() {\r\n    // 找到父级是否有需要滚动的元素\r\n    let result = null;\r\n    const parents = findParents(this.el);\r\n    parents.forEach((ele) => {\r\n      if(ele.getAttribute('scroll') === 'y') {\r\n        result = {\r\n          dom: ele,\r\n          x: ele.clientWidth,\r\n          y: ele.clientHeight\r\n        };\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n\r\n  // 初始化鼠标事件\r\n  initMouse(options) {\r\n    let press = false;\r\n    this.scrollBody = new MouseHandler(options);\r\n    // 长按动作\r\n    this.scrollBody.press = (e) => {\r\n      press = true;\r\n      this.scrollBody.stop = true;\r\n      this.initDomList(e); // 初始化DomList\r\n    };\r\n    // 移动动作\r\n    this.scrollBody.move = (e, start, end) => {\r\n      // 监听移动，并变更移动块位置\r\n      if(this.scroll) this.scroll.stopScrolly();\r\n      if (press && this.currentKey !== null) {\r\n        this.moveTimerHandler();\r\n        this.setMovePosition(start, end);\r\n      }\r\n    };\r\n    // 结束动作\r\n    this.scrollBody.over = (e) => {\r\n      if (press && this.currentKey !== null) {\r\n        // 当鼠标松开时执行的方法\r\n        this.moveOver();\r\n      }\r\n      press = false;\r\n      this.scrollBody.stop = false;\r\n    };\r\n  }\r\n\r\n  /*\r\n   * 初始化元素的位置信息\r\n   * */\r\n  initDomList(e) {\r\n    this.scrollEle = this.getScrollEle();\r\n    /*\r\n     * 设置需要进行排序的doms\r\n     * */\r\n    this.domList = Array.prototype.map.call(\r\n      this.el.querySelectorAll('[name=move-block]'),\r\n      (item) => item\r\n    );\r\n    /**\r\n     * 注意：这里的positions与domList的顺序可能不一致（根据y、x轴进行排序）\r\n     */\r\n    this.positions = this.domList.map((dom, key) => {\r\n      const parent = dom.parentElement;\r\n      const top = parent.offsetTop;\r\n      const left = parent.offsetLeft;\r\n      const width = dom.clientWidth;\r\n      const height = dom.clientHeight;\r\n      const unid = dom.getAttribute('unid');\r\n      return {\r\n        unid,\r\n        key,\r\n        top,\r\n        left,\r\n        width,\r\n        height,\r\n        scopeX: [left, left + width],\r\n        scopeY: [top, top + height],\r\n        translate: {\r\n          x: 0,\r\n          y: 0\r\n        }\r\n      };\r\n    });\r\n    this.resetPositions();\r\n    this.findElement(getPath(e));\r\n    this.setDomPosition();\r\n  }\r\n\r\n  /*\r\n   * 找到当前选中的移动元素\r\n   * */\r\n  findElement(path) {\r\n    path.forEach((dom, key) => {\r\n      if (dom.getAttribute && dom.getAttribute('name') === 'move-block') {\r\n        this.currentDom = dom;\r\n        this.currentBaseClass = dom.getAttribute('class');\r\n        this.currentKey = this.positions.findIndex(\r\n          (v) => v.key === Number(dom.getAttribute('move-index'))\r\n        );\r\n        this.currentDom.setAttribute('class', this.currentBaseClass + ' ' + this.activeClass);\r\n      }\r\n    });\r\n  }\r\n\r\n  /*\r\n   * 设置滑动位置\r\n   * */\r\n  setMovePosition(start, end) {\r\n    this.cacheMove = { start, end };\r\n    const moveX = end.x - start.x;\r\n    const moveY = end.y - start.y + this.fixScrollY;\r\n    const currentXY = this.positions[this.currentKey];\r\n    const translate = currentXY.moving || currentXY.translate;\r\n    currentXY.moveX = moveX;\r\n    currentXY.moveY = moveY;\r\n    this.currentDom.setAttribute(\r\n      'style',\r\n      `\r\n      position:absolute;\r\n      top:0;\r\n      left:0;\r\n      transform:translate(${translate.x + moveX}px, ${translate.y + moveY}px);\r\n      z-index: 100;\r\n    `\r\n    );\r\n  }\r\n\r\n  /*\r\n   * 向上滚动 -1\r\n   * */\r\n  scrollTop() {\r\n    if(!this.cacheMove) return;\r\n    this.fixScrollY -= 1;\r\n    this.setMovePosition(this.cacheMove.start, this.cacheMove.end);\r\n  }\r\n\r\n  /*\r\n   * 向下滚动 +1\r\n   * */\r\n  scrollBottom() {\r\n    if(!this.cacheMove) return;\r\n    this.fixScrollY += 1;\r\n    this.setMovePosition(this.cacheMove.start, this.cacheMove.end);\r\n  }\r\n\r\n  /*\r\n   * 设置开始移动doms位置\r\n   * */\r\n  setDomPosition() {\r\n    if (this.currentKey === null) return;\r\n    const currentXY = this.positions[this.currentKey];\r\n    const translate = currentXY.translate;\r\n    this.currentDom.setAttribute(\r\n      'style',\r\n      `\r\n      position:absolute;\r\n      top:0;\r\n      left:0;\r\n      transform:translate(${translate.x}px, ${translate.y}px);\r\n      z-index: 100;\r\n    `\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 解放元素\r\n   */\r\n  setFreeElement() {\r\n    const currentXY = this.positions[this.currentKey];\r\n    const translate = currentXY.translate;\r\n    delete currentXY.moving;\r\n    const style = `\r\n      transform:translate(${translate.x}px, ${translate.y}px);\r\n    `;\r\n    this.currentDom.setAttribute(\r\n      'style',\r\n      `\r\n      ${style}\r\n      position:absolute;\r\n      top:0;\r\n      left:0;\r\n      transition: all 0.5s;\r\n      z-index: 100;\r\n    `\r\n    );\r\n    setTimeout(() => {\r\n      this.currentDom.setAttribute('class', this.currentBaseClass);\r\n      this.currentDom.setAttribute('style', style);\r\n    }, 500);\r\n  }\r\n\r\n  /**\r\n   * 记录移动过程中的信息，并设置定时器，处理排序任务\r\n   */\r\n  moveTimerHandler(position) {\r\n    if (this.moveTimer) clearTimeout(this.moveTimer);\r\n    this.moveTimer = setTimeout(() => {\r\n      const status = this.resetQuene();\r\n      if(status === 'none') {\r\n        // 判断是否处于需要上下滚动的内容中\r\n        if(this.scrollEle && this.scroll) {\r\n          const scrollDOM = this.scrollEle.dom;\r\n          const currentDOM = this.currentDom;\r\n          const scrollRECT = this.scrollEle;\r\n          const currentXY = this.positions[this.currentKey];\r\n          const translate = { x: currentXY.moveX, y: currentXY.moveY};\r\n          const offset = getOffsetDOM(this.currentDom, scrollDOM, translate);\r\n          // console.log('scrollRECT' + JSON.stringify(scrollRECT));\r\n          // console.log('offset' + JSON.stringify(offset));\r\n          // console.log('currentDOM' + JSON.stringify(currentDOM.clientHeight));\r\n          const status = judgeScroll(scrollRECT, offset, currentDOM.clientHeight, this.fixScrollY, this.scroll.scrollY);\r\n          if(status === 'top') {\r\n            this.scroll.startToTop(() => {\r\n              this.scrollTop();\r\n            });\r\n          } else if(status === 'bottom') {\r\n            this.scroll.startToBottom(() => {\r\n              this.scrollBottom();\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }, 300);\r\n  }\r\n\r\n  /**\r\n   * 当鼠标停下超过300毫秒，将会判断是否触发排序\r\n   */\r\n  resetQuene() {\r\n    let result = 'none';\r\n    const currentXY = this.positions[this.currentKey];\r\n    const currentTranslate = currentXY.moving || currentXY.translate;\r\n    const currentX = currentXY.left + currentXY.moveX + currentTranslate.x;\r\n    const currentY = currentXY.top + currentXY.moveY + currentTranslate.y;\r\n    const currentKey = this.currentKey;\r\n    this.positions.forEach((position, key) => {\r\n      if (currentKey !== key) {\r\n        const translate = position.translate;\r\n        const _x = Math.abs(position.left + translate.x - currentX);\r\n        const _y = Math.abs(position.top + translate.y - currentY);\r\n        if (_x <= 30 && _y <= 30) {\r\n          printLog('重新排序：' + this.currentKey + '---to---' + key, 'move-block');\r\n          result = 'resort';\r\n          // 当往前排时，替换的元素往前挪\r\n          /** 对positions重新排序 **/\r\n          const moveInfo = this.cacheChangePositions(currentKey, key, this.positions);\r\n          moveInfo.forEach((move) => {\r\n            printLog(move, 'move-block');\r\n            if (move.moving) this.positions[move.from].moving = move.moving;\r\n            this.positions[move.from].translate = move.translate;\r\n          });\r\n          // 排序动作\r\n          this.resetQueneDom();\r\n          // 重新对positions进行排序\r\n          this.currentKey = key;\r\n          this.resetPositions();\r\n        }\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * 缓存位置变更信息\r\n   */\r\n  cacheChangePositions(currentKey, key, positions) {\r\n    let moveInfo = [];\r\n    moveInfo.push({\r\n      from: currentKey,\r\n      to: key,\r\n      translate: { ...this.domToPosition(positions[currentKey], positions[key]) },\r\n      moving: { ...(positions[currentKey].moving || positions[currentKey].translate) }\r\n    });\r\n    if (currentKey < key) {\r\n      // 当往前排时，currentKey - key 的元素往前挪\r\n      for (let i = currentKey + 1; i <= key; i++) {\r\n        moveInfo.push({\r\n          from: i,\r\n          to: i - 1,\r\n          translate: { ...this.domToPosition(positions[i], positions[i - 1]) }\r\n        });\r\n      }\r\n    } else {\r\n      // 当往后排时，key - currentKey 的元素往后挪\r\n      for (let i = key; i < currentKey; i++) {\r\n        moveInfo.push({\r\n          from: i,\r\n          to: i - 1,\r\n          translate: { ...this.domToPosition(positions[i], positions[i + 1]) }\r\n        });\r\n      }\r\n    }\r\n    return moveInfo;\r\n  }\r\n\r\n  /**\r\n   * 移动一个元素到后一个的位置\r\n   */\r\n  domToPosition(p1, p2) {\r\n    const x = p2.left + p2.translate.x - p1.left;\r\n    const y = p2.top + p2.translate.y - p1.top;\r\n    return { x, y };\r\n  }\r\n\r\n  /**\r\n   * 针对重新排的position设置位置\r\n   * 注：dom顺序不变，绝对定位变了\r\n   */\r\n  resetQueneDom() {\r\n    const currentKey = this.currentKey;\r\n    this.positions.forEach((position, key) => {\r\n      if (currentKey === key) return;\r\n      const dom = this.domList[position.key];\r\n      const translate = position.translate;\r\n      const style = `\r\n        transform:translate(${translate.x}px, ${translate.y}px);\r\n      `;\r\n      dom.setAttribute(\r\n        'style',\r\n        `${style}\r\n        transition: all 0.5s;\r\n      `\r\n      );\r\n      setTimeout(() => {\r\n        dom.setAttribute('style', style);\r\n      }, 500);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 重新对positions进行排序\r\n   * 首先根据纵坐标排序，再进行横坐标排序\r\n   * 排序方式，从小到大\r\n   */\r\n  resetPositions() {\r\n    this.positions = this.positions.sort(function (a, b) {\r\n      const ayx =\r\n        ('0000000000' + (a.top + a.translate.y)).slice(-10) +\r\n        ('0000000000' + (a.left + a.translate.x)).slice(-10);\r\n      const byx =\r\n        ('0000000000' + (b.top + b.translate.y)).slice(-10) +\r\n        ('0000000000' + (b.left + b.translate.x)).slice(-10);\r\n      return ayx > byx ? 1 : -1;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 设置松开事件\r\n   */\r\n  moveOver() {\r\n    this.setFreeElement();\r\n    setTimeout(() => {\r\n      this.resortdom();\r\n      // 对数据进行清空\r\n      this.resetData();\r\n    }, 500);\r\n  }\r\n\r\n  /**\r\n   * 对dom进行重写排序\r\n   */\r\n  resortdom() {\r\n    let result = [];\r\n    let list = this.getList();\r\n    this.positions.forEach((position, key) => {\r\n      result[key] = list[position.key];\r\n    });\r\n    this.domList.forEach((dom) => {\r\n      dom.setAttribute('style', '');\r\n    });\r\n    this.resetList(result);\r\n  }\r\n\r\n  /**\r\n   * 清空数据\r\n   */\r\n  resetData() {\r\n    clearTimeout(this.moveTimer);\r\n    this.moveTimer = null;\r\n    this.positions = null;\r\n    this.currentKey = null;\r\n    this.currentDom = null;\r\n    this.domList = [];\r\n    this.scrollEle = null;\r\n    this.cacheMove = null;\r\n    this.fixScrollY = 0;\r\n  }\r\n\r\n  /**\r\n   * 销毁实例缓存\r\n   */\r\n  destroy() {\r\n    clearTimeout(this.moveTimer);\r\n    this.moveTimer = null;\r\n    this.positions = null;\r\n    this.currentKey = null;\r\n    this.currentDom = null;\r\n    this.domList = [];\r\n    this.scrollEle = null;\r\n    this.cacheMove = null;\r\n    this.fixScrollY = 0;\r\n    // 全部清除\r\n    this.el = null;\r\n    this.scroll = null;\r\n  }\r\n}\r\n\r\n/**\r\n * 查找某一个元素的父级\r\n */\r\nfunction findParents(Node) {\r\n  let result = [Node];\r\n  const target = Node;\r\n  let parent = target.parentElement;\r\n  while (parent) {\r\n    result.push(parent);\r\n    parent = parent.parentElement;\r\n  }\r\n  return result;\r\n}\r\n\r\n// 判定是在底部或是在顶部\r\nfunction judgeScroll(p1, p2, fixBottom, fix, scrollY) {\r\n  const value = p1.y - (p2.y - fix - scrollY);\r\n  const topValue = p1.y - 60;\r\n  const bottomValue = 60 + fixBottom;\r\n  if(value >=  topValue) {\r\n    return 'top';\r\n  } else if (value <= bottomValue) {\r\n    return 'bottom';\r\n  } else {\r\n    return 'middle';\r\n  }\r\n}\r\n// 找到当前元素与滚动元素之间所有doms\r\nfunction findInDOM(start, end) {\r\n  let result = [];\r\n  let parent = start;\r\n  while(parent && parent !== end) {\r\n    parent = parent.parentElement;\r\n    result.push(parent);\r\n  }\r\n  return result;\r\n}\r\n// 获取dom之间的相对位置\r\nfunction getOffsetDOM(start, end, translate) {\r\n  const parents = findInDOM(start, end);\r\n  let result = { x: translate.x, y: translate.y };\r\n  function getOffset(node) {\r\n    result = {\r\n      x: node.offsetLeft + result.x,\r\n      y: node.offsetTop + result.y\r\n    };\r\n  }\r\n  getOffset(start);\r\n  parents.forEach((dom) => {\r\n    getOffset(dom);\r\n  });\r\n  return result;\r\n}\r\n","import { printLog, openLog, deepCopy } from './utils';\r\nimport MouseHandler from './mouse-handler';\r\n\r\nvar rAF = window.requestAnimationFrame\t||\r\n\twindow.webkitRequestAnimationFrame\t||\r\n\twindow.mozRequestAnimationFrame\t\t||\r\n\twindow.oRequestAnimationFrame\t\t||\r\n\twindow.msRequestAnimationFrame\t\t||\r\n\tfunction (callback) { window.setTimeout(callback, 1000 / 60); };\r\n\r\nopenLog('move-block');\r\n\r\nexport default class UseScrollY {\r\n  /*\r\n   * */\r\n  constructor(options) {\r\n    /*\r\n     * 这里仅获取当前调用组件内的元素\r\n     * 若是其他地方有重复组件（如首屏滑块），需要将排序数据存入store\r\n     * */\r\n    if (options.wrap instanceof Node) this.wrap = options.wrap;\r\n    else throw Error('wrap must be a Element');\r\n    if (options.el instanceof Node) this.el = options.el;\r\n    else throw Error('el must be a Element');\r\n    this.scrollY = 0;\r\n    this.lastScrollY = 0;\r\n    this.maxScrollHeight = this.el.clientHeight - this.wrap.clientHeight;\r\n    /*\r\n     * 实例化鼠标事件\r\n     * */\r\n    if(this.maxScrollHeight > 0) {\r\n      this.initMouse(options);\r\n    }\r\n    this.timer = null;\r\n    this.wrapHeight = this.wrap.clientHeight;\r\n    this.elHeight = this.el.clientHeight;\r\n\r\n    this.maxScrollHeight = this.elHeight - this.wrapHeight;\r\n  }\r\n\r\n  initMouse(options) {\r\n    this.scrollBody = new MouseHandler(options);\r\n    let isScroll = null;\r\n    let isdown = false;\r\n    let startY = 0;\r\n    let endY = 0;\r\n    let startTime = 0;\r\n    let endTime = 0;\r\n    this.scrollBody.down = (e) => {\r\n      isdown = true;\r\n    };\r\n    // 移动动作\r\n    this.scrollBody.move = (e, start, end) => {\r\n      if(!isdown) return;\r\n      // 监听移动，并变更移动块位置\r\n      // 当纵向 / 横向 移动比例超过3，且纵向长度超过30px，即认定开始滚动\r\n      const x = end.x - start.x;\r\n      const y = end.y - start.y;\r\n      if (isScroll === null) {\r\n        const ratio = Math.abs(y) / (Math.abs(x) + 1);\r\n        if (ratio >= 3 && Math.abs(y) >= 30) {\r\n          startTime = new Date().getTime();\r\n          isScroll = true;\r\n          startY = y;\r\n        }\r\n      }\r\n      if (isScroll) {\r\n        endY = y;\r\n        this.scrollBody.stop = true;\r\n        this.setScrollY(y - startY);\r\n      }\r\n    };\r\n\r\n    this.scrollBody.over = (e) => {\r\n      this.scrollBody.stop = false;\r\n      this.lastScrollY = this.scrollY;\r\n      // 检查滑动速度，设置缓冲距离\r\n      endTime = new Date().getTime();\r\n      let moveTime = endTime - startTime;\r\n      let moveDistance = endY - startY;\r\n      let speedRate = moveDistance / moveTime;\r\n      if(Math.abs(speedRate) > 0.5) {\r\n        // 进行缓冲\r\n        speedRate = speedRate > 0 ? -1 : 1;\r\n        this.setDomScrollBuffer(speedRate * 100);\r\n      }\r\n      isScroll = null;\r\n      isdown = false;\r\n      startY = 0;\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 设置scrolly\r\n   */\r\n  setScrollY(y) {\r\n    // y表示当前鼠标按下动作过程滚动距离\r\n    let result = true;\r\n    let next = this.lastScrollY - y;\r\n    if(next < 0) {\r\n      next = 0;\r\n      result = false;\r\n    } else if(next >= this.maxScrollHeight) {\r\n      next = this.maxScrollHeight;\r\n      result = false;\r\n    }\r\n    this.scrollY = next;\r\n    this.setDomScroll(next);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * scroll to top\r\n   */\r\n  startToTop(callback) {\r\n    this.timer = setInterval(() => {\r\n      const result = this.setScrollY(1);\r\n      this.lastScrollY = this.scrollY;\r\n      if(callback && result) callback(1);\r\n    }, 16);\r\n  }\r\n\r\n  /**\r\n   * scroll to bottom\r\n   */\r\n  startToBottom(callback) {\r\n    this.timer = setInterval(() => {\r\n      const result = this.setScrollY(-1);\r\n      this.lastScrollY = this.scrollY;\r\n      if(callback && result) callback(-1);\r\n    }, 16);\r\n  }\r\n  \r\n  /**\r\n   * stop scroll to bottom\r\n   */\r\n  stopScrolly() {\r\n    if(this.timer) clearInterval(this.timer);\r\n  }\r\n\r\n  /*\r\n   * 设置元素的位置信息\r\n   * */\r\n  setDomScroll(scrolly) {\r\n    rAF(() => {\r\n      this.el.setAttribute('style', `transform:translate(0, -${scrolly}px)`);\r\n    });\r\n  }\r\n\r\n  /*\r\n   * 设置缓冲\r\n   * */\r\n  setDomScrollBuffer(sy) {\r\n    let next = this.lastScrollY + sy;\r\n    if(next < 0) {\r\n      next = 0;\r\n    } else if(next >= this.maxScrollHeight) {\r\n      next = this.maxScrollHeight;\r\n    }\r\n    const distance = Math.abs(next - this.lastScrollY);\r\n    let slideTime = distance / 800;\r\n    this.lastScrollY = next;\r\n    // rAF(() => {\r\n\r\n    // })\r\n    this.el.setAttribute('style', `transform:translate(0, -${next}px);transition: all ${slideTime}s;`);\r\n    setTimeout(() => {\r\n      this.el.setAttribute('style', `transform:translate(0, -${next}px);`);\r\n    }, 500);\r\n  }\r\n\r\n  /**\r\n   * 销毁实例缓存\r\n   */\r\n  destroy() {\r\n    this.wrap = null;\r\n    this.el = null;\r\n  }\r\n}\r\n","import UseDragSort from './core/mouse-dragsort';\r\nimport UseScrollY from './core/mouse-scroll-y';\r\n\r\n/*\r\n * 为mixpad的鼠标事件添加获取path的方法\r\n * */\r\nMouseEvent.prototype.getPath = function () {\r\n  if (this.path) {\r\n    return this.path;\r\n  } else {\r\n    const target = this.target;\r\n    let path = [target];\r\n    if (target instanceof Node) {\r\n      let parent = target.parentElement;\r\n      while (parent) {\r\n        path.push(parent);\r\n        parent = parent.parentElement;\r\n      }\r\n      return path;\r\n    } else {\r\n      return path;\r\n    }\r\n  }\r\n};\r\n\r\nexport default {\r\n  UseScrollY,\r\n  UseDragSort\r\n};\r\n"],"names":["types","openLog","type","printLog","message","undefined","console","log","getPath","mouseEvent","path","target","Node","parent","parentElement","push","ASSERT_MOVE","ASSERT_PRESS","isPc","IsPC","eventTyps","start","move","end","MouseHandler","options","el","wrap","Error","$options","initData","addEventListener","mousedown","bind","mousemove","document","mouseup","scene","action","downtime","uptime","startCoor","x","y","moveCoor","endCoor","stop","e","stopPropagation","setAction","Date","getTime","down","setTimeout","assertPressOrMove","isPress","setScene","press","pressDelay","during","click","pressEnd","eventOver","_x","Math","abs","_y","isMove","over","userAgentInfo","navigator","userAgent","Agents","flag","v","length","indexOf","UseDragSort","currentDom","currentKey","moveTimer","initMouse","getList","resetList","activeClass","currentBaseClass","scroll","fixScrollY","cacheMove","result","parents","findParents","forEach","ele","getAttribute","dom","clientWidth","clientHeight","scrollBody","initDomList","stopScrolly","moveTimerHandler","setMovePosition","moveOver","scrollEle","getScrollEle","domList","Array","prototype","map","call","querySelectorAll","item","positions","key","top","offsetTop","left","offsetLeft","width","height","unid","scopeX","scopeY","translate","resetPositions","findElement","setDomPosition","findIndex","Number","setAttribute","moveX","moveY","currentXY","moving","style","position","clearTimeout","status","resetQuene","scrollDOM","currentDOM","scrollRECT","offset","getOffsetDOM","judgeScroll","scrollY","startToTop","scrollTop","startToBottom","scrollBottom","currentTranslate","currentX","currentY","moveInfo","cacheChangePositions","from","resetQueneDom","to","domToPosition","i","p1","p2","sort","a","b","ayx","slice","byx","setFreeElement","resortdom","resetData","list","fixBottom","fix","value","topValue","bottomValue","findInDOM","getOffset","node","rAF","window","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","UseScrollY","lastScrollY","maxScrollHeight","timer","wrapHeight","elHeight","isScroll","isdown","startY","endY","startTime","endTime","ratio","setScrollY","moveTime","moveDistance","speedRate","setDomScrollBuffer","next","setDomScroll","setInterval","clearInterval","scrolly","sy","distance","slideTime","MouseEvent"],"mappings":"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"}